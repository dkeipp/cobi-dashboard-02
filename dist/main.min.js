!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=function(){function a(){this.localStorageAvailable=!1,this.maxSpeed=0,this.maxSpeedCeiling=20,this.maxSpeedCeilingBuffer=5,this.averageSpeed=0,this.averageSpeedMultiplier=10,this.maxCadence=0,this.maxCadenceCeiling=50,this.maxCadenceCeilingBuffer=10,this.averageCadence=0,this.averageCadenceMultiplier=100,this.localStorageAvailable="undefined"!=typeof Storage}return a.prototype.calculateSpeedBasedRotation=function(a){var b=100/this.maxSpeedCeiling*a;return 1.8*b},a.prototype.calculateCadenceBasedRotation=function(a){var b=100/this.maxCadenceCeiling*a;return 1.8*b},a.prototype.setAverageSpeed=function(b){null===this.averageSpeed&&(this.averageSpeed=b),b>0&&(this.averageSpeed=a.round((this.averageSpeed*(this.averageSpeedMultiplier-1)+b)/this.averageSpeedMultiplier),this.storeItem("averageSpeed",this.averageSpeed))},a.prototype.setAverageCadence=function(b){null===this.averageCadence&&(this.averageCadence=b),b>0&&(this.averageCadence=a.round((this.averageCadence*(this.averageCadenceMultiplier-1)+b)/this.averageCadenceMultiplier),this.storeItem("averageCadence",this.averageCadence))},a.prototype.getAverageSpeed=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("averageSpeed");"undefined"!=typeof a&&(this.averageSpeed=a)}return this.averageSpeed},a.prototype.getAverageCadence=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("averageCadence");"undefined"!=typeof a&&(this.averageCadence=a)}return this.averageCadence},a.prototype.setMaxSpeed=function(b){b>this.maxSpeedCeiling&&(this.maxSpeed=a.round(b),this.maxSpeedCeiling=Math.ceil(this.maxSpeed/this.maxSpeedCeilingBuffer)*this.maxSpeedCeilingBuffer,this.maxSpeed===this.maxSpeedCeiling&&(this.maxSpeedCeiling+=5),this.storeItem("maxSpeed",this.maxSpeed),this.storeItem("maxSpeedCeiling",this.maxSpeedCeiling))},a.prototype.getMaxSpeed=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("maxSpeed");"undefined"!=typeof a&&(this.maxSpeed=a)}else this.maxSpeed=this.getAverageSpeed();return this.maxSpeed},a.prototype.getMaxSpeedCeiling=function(){return this.maxSpeedCeiling},a.prototype.setMaxCadence=function(b){b>this.maxCadenceCeiling&&(this.maxCadence=a.round(b),this.maxCadenceCeiling=Math.ceil(this.maxCadence/this.maxCadenceCeilingBuffer)*this.maxCadenceCeilingBuffer,this.maxCadence===this.maxCadenceCeiling&&(this.maxCadenceCeiling+=this.maxCadenceCeilingBuffer),this.storeItem("maxCadence",this.maxCadence),this.storeItem("maxCadenceCeiling",this.maxCadenceCeiling))},a.prototype.getMaxCadence=function(){if(this.localStorageAvailable===!0){var a=localStorage.getItem("maxCadence");"undefined"!=typeof a&&(this.maxCadence=a)}else this.maxCadence=this.getAverageCadence();return this.maxCadence},a.prototype.getMaxCadenceCeiling=function(){return this.maxCadenceCeiling},a.round=function(a){return Math.round(10*a)/10},a.decimal=function(a){return a.toFixed(1)},a.prototype.storeItem=function(a,b){this.localStorageAvailable===!0&&localStorage.setItem(a,b)},a}();c.__esModule=!0,c["default"]=d},{}],2:[function(a,b,c){var d=a("./../core"),e=function(){function a(a,b,c,d){this.core=null,this.arcBackgroundColor="#444353",this.arcBackgroundShadowColor="#444353",this.arcForeGroundColor="#00C8E6",this.arcForeGroundShadowColor="#00C8E6",this.arcPointerColor="#FFF",this.arcPointerShadowColor="#FFF",this.cadenceArcX=0,this.cadenceArcY=0,this.checkSpeedInterval=1e3,this.checkSpeedIntervalObject=null,this.lastSpeedUpdate=0,this.averageCadenceInterval=1e3,this.averageCadenceIntervalObject=null,this.lastCadenceUpdate=0,this.checkCadenceInterval=1e3,this.checkCadenceIntervalObject=null,this.speedArcRotation=270,this.candenceArcRotation=90,this.displayShadowColor="#00C8E6",this.displayShadowBlur=50,this.arcForeGroundShadowBlur=10,this.arcPointerShadowBlur=10,this.arcPointerOpacity=.9,this.core=a,this.stageWidth=c,this.stageHeight=d,this.stageContainer=b,this.arcWidth=.05*this.stageHeight,this.arcOuterRadius=.9*this.stageHeight/2,this.arcInnerRadius=this.arcOuterRadius-this.arcWidth,this.displayMaxSize=.1*this.stageHeight,this.bottomWidth=.19*this.stageWidth,this.speedArcX=this.stageWidth-this.arcOuterRadius-.02*this.stageWidth,this.speedArcY=this.stageHeight/2,this.speedDisplayFullX=.53*this.stageWidth,this.speedDisplayFullY=.55*this.stageHeight,this.speedDisplayFullSize=.3*this.stageHeight,this.speedDisplayDecimalX=.85*this.stageWidth,this.speedDisplayDecimalY=this.speedDisplayFullY,this.speedDisplayDecimalSize=.15*this.stageHeight,this.speedDisplayMaxX=this.speedArcX-.12*this.stageWidth,this.speedDisplayMaxY=.02*this.stageWidth,this.cadenceDisplayX=0,this.cadenceDisplayY=.55*this.stageHeight,this.cadenceDisplayMaxX=this.cadenceArcX+.3*this.stageWidth,this.cadenceDisplayMaxY=.02*this.stageWidth,this.cadenceArcX=this.arcOuterRadius+.02*this.stageWidth,this.cadenceArcY=this.stageHeight/2}return a.prototype.initView=function(){this.stage=new Konva.Stage({container:this.stageContainer,width:this.stageWidth,height:this.stageHeight}),this.layer=new Konva.Layer,this.speedMask=new Konva.Group({clip:{x:this.speedArcX,y:0,width:this.stageWidth,height:this.stageHeight}}),this.speedArcBackground=new Konva.Arc({x:this.speedArcX,y:this.speedArcY,innerRadius:this.arcInnerRadius,outerRadius:this.arcOuterRadius,angle:180,fill:this.arcBackgroundColor,rotation:this.speedArcRotation}),this.speedBottom=new Konva.Rect({x:this.speedArcX-this.bottomWidth,y:2*this.arcOuterRadius,width:this.bottomWidth,height:this.arcWidth,fill:this.arcBackgroundColor,shadowEnabled:!0,shadowBlur:this.arcForeGroundShadowBlur,shadowColor:this.arcForeGroundShadowColor}),this.curSpeedArc=new Konva.Arc({x:this.speedArcX,y:this.speedArcY,innerRadius:this.arcInnerRadius,outerRadius:this.arcOuterRadius,angle:180,fill:this.arcForeGroundShadowColor,rotation:this.speedArcRotation,shadowEnabled:!0,shadowBlur:this.arcForeGroundShadowBlur,shadowColor:this.arcForeGroundShadowColor}),this.averageSpeedArc=new Konva.Arc({x:this.speedArcX,y:this.speedArcY,innerRadius:this.arcInnerRadius,outerRadius:this.arcOuterRadius,angle:2,opacity:0,fill:this.arcPointerColor,rotation:this.speedArcRotation,shadowEnabled:!0,shadowBlur:this.arcPointerShadowBlur,shadowColor:this.arcPointerShadowColor}),this.averageCadenceArc=new Konva.Arc({x:this.cadenceArcX,y:this.cadenceArcY,innerRadius:this.arcInnerRadius,outerRadius:this.arcOuterRadius,angle:2,opacity:0,fill:this.arcPointerColor,rotation:this.candenceArcRotation,shadowEnabled:!0,shadowBlur:this.arcPointerShadowBlur,shadowColor:this.arcPointerShadowColor}),this.cadenceArcBackground=new Konva.Arc({x:this.cadenceArcX,y:this.cadenceArcY,innerRadius:this.arcInnerRadius,outerRadius:this.arcOuterRadius,angle:180,fill:this.arcBackgroundColor,rotation:this.candenceArcRotation}),this.cadenceBottom=new Konva.Rect({x:this.cadenceArcX,y:2*this.arcOuterRadius,width:this.bottomWidth,height:this.arcWidth,fill:this.arcBackgroundColor,shadowEnabled:!0,shadowBlur:this.arcForeGroundShadowBlur,shadowColor:this.arcForeGroundShadowColor}),this.curCadenceArc=new Konva.Arc({x:this.cadenceArcX,y:this.cadenceArcY,innerRadius:this.arcInnerRadius,outerRadius:this.arcOuterRadius,angle:180,fill:this.arcForeGroundColor,rotation:this.candenceArcRotation,shadowEnabled:!0,shadowBlur:this.arcForeGroundShadowBlur,shadowColor:this.arcForeGroundShadowColor}),this.cadenceDisplay=new Konva.Text({x:this.cadenceDisplayX,y:this.cadenceDisplayY,text:"0",fontSize:this.speedDisplayFullSize,fontFamily:"UniSans",fill:"#fff",align:"right",width:.35*this.stageWidth,shadowEnabled:!0,shadowBlur:this.displayShadowBlur,shadowColor:this.displayShadowColor}),this.speedDisplayFull=new Konva.Text({x:this.speedDisplayFullX,y:this.speedDisplayFullY,text:"0",fontSize:this.speedDisplayFullSize,fontFamily:"UniSans",fill:"#fff",align:"right",width:.3*this.stageWidth,shadowEnabled:!0,shadowBlur:this.displayShadowBlur,shadowColor:this.displayShadowColor}),this.speedDisplayDecimal=new Konva.Text({x:this.speedDisplayDecimalX,y:this.speedDisplayDecimalY,text:"0",fontSize:this.speedDisplayDecimalSize,fontFamily:"UniSans",fill:"#fff",shadowEnabled:!0,shadowBlur:this.displayShadowBlur,shadowColor:this.displayShadowColor}),this.speedDisplayMax=new Konva.Text({x:this.speedDisplayMaxX,y:this.speedDisplayMaxY,text:"0",fontSize:this.displayMaxSize,fontFamily:"UniSans",fill:"#fff",align:"right",shadowEnabled:!0,shadowBlur:this.displayShadowBlur,shadowColor:this.displayShadowColor}),this.cadenceDisplayMax=new Konva.Text({x:this.cadenceDisplayMaxX,y:this.cadenceDisplayMaxY,text:"0",fontSize:this.displayMaxSize,fontFamily:"UniSans",fill:"#fff",align:"right",shadowEnabled:!0,shadowBlur:this.displayShadowBlur,shadowColor:this.displayShadowColor});var a=.475*this.stageWidth,b=.12*this.stageHeight,c=.1*this.stageHeight,d=.05*this.stageHeight;this.bottomBar=new Konva.Shape({sceneFunc:function(e){e.beginPath(),e.moveTo(0,b),e.quadraticCurveTo(c-d,0,c,0),e.lineTo(a,0),e.quadraticCurveTo(a+d,0,a+c,b),e.lineTo(0,b),e.closePath(),e.fillStrokeShape(this)},fill:"#FFF",x:(this.stageWidth-(a+c))/2,y:this.stageHeight-b});var e=new Konva.Rect({x:0,y:0,width:this.stageWidth,height:this.stageHeight,fill:"#1d1d23"});this.layer.add(this.speedArcBackground),this.layer.add(this.speedBottom),this.layer.add(this.cadenceArcBackground),this.layer.add(this.cadenceBottom),this.speedMask.add(this.curSpeedArc),this.speedMask.add(this.averageSpeedArc),this.layer.add(this.curCadenceArc),this.layer.add(this.averageCadenceArc),this.layer.add(this.speedMask),this.layer.add(this.speedDisplayFull),this.layer.add(this.speedDisplayDecimal),this.layer.add(this.speedDisplayMax),this.layer.add(this.cadenceDisplay),this.layer.add(this.cadenceDisplayMax),this.layer.add(this.bottomBar),this.layer.add(e),this.stage.add(this.layer);var f=new Konva.Tween({node:e,opacity:0,duration:2,easing:Konva.Easings.EaseIn,onFinish:function(){e.destroy()}});f.play()},a.prototype.initAverageSpeedView=function(){this.core.setMaxSpeed(this.core.getMaxSpeed()),this.updateAverageSpeedView(this.core.getAverageSpeed(),!0)},a.prototype.initAverageCadenceView=function(){var a=this;this.core.setMaxCadence(this.core.getMaxCadence()),this.updateAverageCadenceView(this.core.getAverageCadence(),!0),null===this.averageCadenceIntervalObject&&(this.averageCadenceIntervalObject=setInterval(function(){a.updateAverageCadenceView(a.core.getAverageCadence(),!1)},this.averageCadenceInterval))},a.prototype.initSpeedCheck=function(){var a=this;null===this.checkSpeedIntervalObject&&(this.checkSpeedIntervalObject=setInterval(function(){(new Date).getTime()-a.lastSpeedUpdate>a.checkSpeedInterval&&a.updateCurrentSpeedView(0)},this.checkSpeedInterval))},a.prototype.initCadenceCheck=function(){var a=this;null===this.checkCadenceIntervalObject&&(this.checkCadenceIntervalObject=setInterval(function(){(new Date).getTime()-a.lastCadenceUpdate>a.checkCadenceInterval&&a.updateCurrentCadenceView(0)},this.checkCadenceInterval))},a.prototype.updateCurrentSpeedView=function(a){this.lastSpeedUpdate=(new Date).getTime(),a=d["default"].round(a);var b=d["default"].decimal(a).split(".");this.speedDisplayFull.text(b[0]),this.speedDisplayDecimal.text(b[1]),this.speedDisplayMax.text(this.core.getMaxSpeed()),this.core.setMaxSpeed(a);var c=1,e=this.arcForeGroundShadowBlur,f=this.arcBackgroundColor;0===a&&(c=0,e=0);var g=new Konva.Tween({node:this.curSpeedArc,rotation:360-this.core.calculateSpeedBasedRotation(a)+90,easing:Konva.Easings.EaseInOut,duration:.5,opacity:c});g.play(),a>0&&(f=this.arcForeGroundColor,e=this.arcForeGroundShadowBlur),g=new Konva.Tween({node:this.speedBottom,easing:Konva.Easings.EaseInOut,duration:.5,fill:f,shadowBlur:e}),g.play()},a.prototype.updateCurrentCadenceView=function(a){this.lastCadenceUpdate=(new Date).getTime(),a=d["default"].round(a),this.core.setMaxCadence(a),this.core.setAverageCadence(a);var b=d["default"].decimal(a).split(".");this.cadenceDisplay.text(b[0]),this.cadenceDisplayMax.text(this.core.getMaxCadence());var c=1,e=this.arcForeGroundShadowBlur,f=this.arcBackgroundColor;0===a&&(c=0,e=0);var g=new Konva.Tween({node:this.curCadenceArc,angle:this.core.calculateCadenceBasedRotation(a),easing:Konva.Easings.EaseInOut,duration:.5,opacity:c});g.play(),a>0&&(f=this.arcForeGroundColor,e=this.arcForeGroundShadowBlur),g=new Konva.Tween({node:this.cadenceBottom,easing:Konva.Easings.EaseInOut,duration:.5,fill:f,shadowBlur:e}),g.play()},a.prototype.updateAverageSpeedView=function(a,b){void 0===b&&(b=!1);var c=this.arcPointerOpacity;null===a&&(c=0),a=d["default"].round(a),this.core.setAverageSpeed(a);var e=.5;b===!0&&(e=5);var f=0;0!==a&&(f=360-(this.core.calculateSpeedBasedRotation(a)+this.speedArcRotation));var g=new Konva.Tween({node:this.averageSpeedArc,rotation:f,easing:Konva.Easings.EaseInOut,duration:e,opacity:c});g.play()},a.prototype.updateAverageCadenceView=function(a,b){void 0===b&&(b=!1);var c=this.arcPointerOpacity;null===a&&(c=0),a=d["default"].round(a),this.core.setAverageCadence(a);var e=.5;b===!0&&(e=5);var f=0;0!==a&&(f=this.core.calculateCadenceBasedRotation(a)+this.candenceArcRotation);var g=new Konva.Tween({node:this.averageCadenceArc,rotation:f,easing:Konva.Easings.EaseInOut,duration:e,opacity:c});g.play()},a}();c.__esModule=!0,c["default"]=e},{"./../core":1}],3:[function(a,b,c){var d=a("./components/core"),e=a("./components/views/experience"),f=function(){function a(a,b,c){this.core=null,this.experienceView=null,this.core=new d["default"],this.stageContainer=a,this.stageWidth=b,this.stageHeight=c}return a.prototype.initExperienceView=function(){document.getElementById(this.stageContainer).classList.remove("hidden"),this.experienceView=new e["default"](this.core,this.stageContainer,this.stageWidth,this.stageHeight),this.experienceView.initView(),this.experienceView.initAverageSpeedView(),this.experienceView.initAverageCadenceView(),this.experienceView.initSpeedCheck(),this.experienceView.initCadenceCheck()},a.prototype.initHomeView=function(){document.getElementById("home").classList.remove("hidden"),document.getElementById("max-speed").innerHTML=this.core.getMaxSpeed()+" km/h",document.getElementById("avr-speed").innerHTML=this.core.getAverageSpeed()+" km/h"},a.prototype.updateCurrentSpeedView=function(a){this.experienceView.updateCurrentSpeedView(a)},a.prototype.updateCurrentCadenceView=function(a){this.experienceView.updateCurrentCadenceView(a)},a.prototype.updateAverageSpeedView=function(a,b){void 0===b&&(b=!1),this.experienceView.updateAverageSpeedView(a,b)},a.getVersion=function(){return this.version},a.version="0.2.0",a}();c.__esModule=!0,c["default"]=f},{"./components/core":1,"./components/views/experience":2}],4:[function(a,b,c){var d=a("./dashboard"),e=new d["default"]("experience",window.innerWidth,window.innerHeight);COBI.init("token — can by anything right now"),"experience"===COBI.parameters.state()?(e.initExperienceView(),COBI.app.theme.subscribe(function(a){console.log(a)}),COBI.rideService.speed.subscribe(function(a){e.updateCurrentSpeedView(3.6*a)}),COBI.tourService.averageSpeed.subscribe(function(a){e.updateAverageSpeedView(3.6*a)}),COBI.rideService.cadenceAvailability.subscribe(function(a){console.log("cadence available: "+a)}),COBI.rideService.cadence.subscribe(function(a){e.updateCurrentCadenceView(a)})):e.initHomeView(),document.getElementById("version").innerHTML=d["default"].getVersion()},{"./dashboard":3}]},{},[4]);
//# sourceMappingURL=main.min.js.map